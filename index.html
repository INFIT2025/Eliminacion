<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Eliminaci√≥n de Alimentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        progress[value]::-webkit-progress-bar {
            background-color: #374151;
            border-radius: 9999px;
            overflow: hidden;
        }
        progress[value]::-webkit-progress-value {
            background-color: #FF9900;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-black text-gray-200">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">

        <header class="text-center mb-12">
            <!-- Infit Logo -->
            <div class="flex justify-center mb-4">
                <img src="logo infit.jpg" alt="Logo de INFIT" class="h-16 md:h-20 rounded-full shadow-lg">
            </div>
            <h1 class="text-4xl md:text-5xl font-black text-white mb-2">Plan de Eliminaci√≥n de Alimentos Da√±inos</h1>
            <p class="text-lg text-[#FF9900]">INFIT tu viaje hacia Tu Mejor Versi√≥n</p>
        </header>

        <section class="mb-12 bg-gray-800 rounded-lg shadow-lg p-6 md:p-8">
            <h2 class="text-3xl font-bold text-center text-[#FF9900] mb-6">‚úÖ Objetivo: Eliminar 5 Grupos de Alimentos</h2>
            <p class="text-center text-gray-400 mb-8">Marca cada grupo a medida que progresas. Tu avance se guardar√° autom√°ticamente.</p>

            <!-- Progress Bar -->
            <div class="w-full h-4 bg-gray-700 rounded-full overflow-hidden mb-8">
                <progress id="progress-bar" class="w-full h-full appearance-none" value="0" max="5"></progress>
            </div>

            <!-- Food Groups Grid -->
            <div id="food-groups-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
                <!-- Items will be dynamically generated by JavaScript -->
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold text-center text-white mb-8">üóìÔ∏è El Proceso de 4 Semanas</h2>
            <div class="relative">
                <div class="hidden md:block absolute top-1/2 left-0 w-full h-1 bg-[#FF9900] opacity-50 transform -translate-y-1/2"></div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div class="bg-gray-800 rounded-lg shadow-lg p-6 border-t-4 border-[#FF9900]">
                        <h3 class="text-xl font-bold text-white mb-2">üü° Semana 1: Conciencia</h3>
                        <p class="text-gray-400">Identifica tus h√°bitos actuales y comienza a reducir las porciones. El objetivo es la moderaci√≥n, no la prohibici√≥n total.</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg shadow-lg p-6 border-t-4 border-[#FF9900]">
                        <h3 class="text-xl font-bold text-white mb-2">üü† Semana 2: Sustituci√≥n</h3>
                        <p class="text-gray-400">Reemplaza activamente las opciones da√±inas por alternativas saludables. Busca versiones integrales y naturales.</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg shadow-lg p-6 border-t-4 border-[#FF9900]">
                        <h3 class="text-xl font-bold text-white mb-2">üü£ Semana 3: Control</h3>
                        <p class="text-gray-400">Establece rutinas y elimina por completo el consumo de ciertos elementos, como el alcohol entre semana. Come conscientemente.</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg shadow-lg p-6 border-t-4 border-[#FF9900]">
                        <h3 class="text-xl font-bold text-white mb-2">üî¥ Semana 4: Eliminaci√≥n</h3>
                        <p class="text-gray-400">El objetivo es la eliminaci√≥n casi total, permitiendo solo una "comida trampa" a la semana. Planifica tus comidas.</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="bg-gray-800 rounded-lg shadow-lg p-6 mb-8 border-t-4 border-[#FF9900]">
            <h2 class="text-3xl font-bold mb-4 text-[#FF9900]">‚ö†Ô∏è Importante</h2>
            <p class="text-lg text-gray-400">Ap√≥yate en tu plan de alimentaci√≥n, ah√≠ encontrar√°s snacks saludables y comida trampa, porque tambi√©n se vale disfrutar.</p>
        </div>
        
        <footer class="text-center bg-gray-800 text-gray-200 p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold mb-4 text-[#FF9900]">¬°Sigue Adelante! üí™</h2>
            <p class="text-lg text-gray-400">Cada d√≠a que sigues tu plan es un paso m√°s hacia Tu Mejor Versi√≥n. Este es un proceso lento, pero con constancia, los resultados llegar√°n.</p>
        </footer>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB1uTv8ZiDfDpc7L3IY2R1-VoBRc7puoBE",
            authDomain: "eliminacion-de-alimentos.firebaseapp.com",
            projectId: "eliminacion-de-alimentos",
            storageBucket: "eliminacion-de-alimentos.firebasestorage.app",
            messagingSenderId: "352209829104",
            appId: "1:352209829104:web:ffc576805fcbb2d49e1635"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let userId = null;
        let dbDocRef = null;

        const foodGroups = [
            { id: 'soda-alcohol', emoji: 'ü•§', name: 'Refrescos y Alcohol' },
            { id: 'fried-foods', emoji: 'üçü', name: 'Frituras' },
            { id: 'refined-flour', emoji: 'üçû', name: 'Harinas Refinadas' },
            { id: 'processed-sweets', emoji: 'üç¨', name: 'Dulces Procesados' },
            { id: 'ultra-processed', emoji: 'üçî', name: 'Ultraprocesados' },
        ];

        const foodGroupsGrid = document.getElementById('food-groups-grid');
        const progressBar = document.getElementById('progress-bar');
        const totalItems = foodGroups.length;

        async function initAuth() {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Error during authentication:", error);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                // Using appId for the document path
                dbDocRef = doc(db, `/artifacts/${firebaseConfig.appId}/users/${userId}/foodEliminationPlan/progress`);
                listenForDataChanges();
            } else {
                console.log("User is signed out.");
            }
        });

        function listenForDataChanges() {
            if (!dbDocRef) {
                console.error("Database document reference is not set.");
                return;
            }

            onSnapshot(dbDocRef, (docSnap) => {
                const data = docSnap.exists() ? docSnap.data() : { completedItems: {} };
                updateUI(data.completedItems);
            }, (error) => {
                console.error("Error listening to Firestore document:", error);
            });
        }

        function updateUI(completedItems) {
            foodGroupsGrid.innerHTML = '';
            let completedCount = 0;

            foodGroups.forEach(group => {
                const isCompleted = completedItems[group.id] === true;
                const card = document.createElement('button');
                card.id = `btn-${group.id}`;
                card.onclick = () => toggleCompletion(group.id, completedItems);
                card.classList.add(
                    'flex', 'flex-col', 'items-center', 'justify-center', 'p-4', 'rounded-lg', 'transition-all', 'duration-300', 'transform',
                    isCompleted ? 'bg-[#FF9900]' : 'bg-gray-700',
                    isCompleted ? 'hover:scale-105' : 'hover:bg-gray-600',
                    isCompleted ? 'text-gray-900' : 'text-gray-200'
                );

                const emojiSpan = document.createElement('span');
                emojiSpan.classList.add('text-5xl', 'mb-2');
                emojiSpan.textContent = isCompleted ? '‚úÖ' : group.emoji;

                const nameH3 = document.createElement('h3');
                nameH3.classList.add('font-bold', isCompleted ? 'text-gray-900' : 'text-[#FF9900]');
                nameH3.textContent = group.name;

                card.appendChild(emojiSpan);
                card.appendChild(nameH3);
                foodGroupsGrid.appendChild(card);

                if (isCompleted) {
                    completedCount++;
                }
            });

            progressBar.value = completedCount;
        }

        async function toggleCompletion(itemId, completedItems) {
            if (!dbDocRef) {
                console.error("Database document reference is not set. Cannot update.");
                return;
            }

            const newCompletedItems = {
                ...completedItems,
                [itemId]: !completedItems[itemId]
            };

            try {
                await setDoc(dbDocRef, { completedItems: newCompletedItems, _lastUpdated: new Date() });
            } catch (error) {
                console.error("Error updating document:", error);
            }
        }

        initAuth();

    </script>
</body>
</html>
